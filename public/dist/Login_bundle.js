(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{26:function(e,r,a){"use strict";a.r(r),a.d(r,"default",(function(){return p}));var n=a(0),t=a.n(n),o=a(10);function i(){return(i=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var a=arguments[r];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}const s={fontFamily:"Press Start"};function l({value:e="",type:r="text",padding:a=10,autofocus:n,...o}){const[l,c]=t.a.useState(e),u=a-l.length,m="_".repeat(u>0?u:0);return n&&(o.ref=e=>e&&e.focus()),t.a.createElement("div",{className:"underlinedinput",style:{position:"relative"}},t.a.createElement("div",{className:"underline",style:{position:"absolute",left:0,top:".3em",zIndex:0,...s}},t.a.createElement("span",{style:{opacity:0}},l),t.a.createElement("span",null,m)),t.a.createElement("input",i({type:r,value:l,onChange:e=>{c(e.target.value)},style:{position:"relative",zIndex:1,...s}},o)))}var c=a(3),u=a(4);a(7);console.log("<Login> has been lazy loaded!");const m={isOpen:!0,isLoading:!1,isError:!1,mode:"login",current:"username",user:{},error:{}},d=(e,r)=>{switch(r.type){case"RESET":return{...m};case"TOGGLE":return{...m,isOpen:!e.isOpen};case"INIT":return{...e,isLoading:!0,isError:!1};case"SUBMIT":return{...e,isLoading:!1,isError:!1,current:r.current,user:{...e.user,[r.inputName]:r.inputValue}};case"REGISTER":return{...e,isLoading:!1,isError:!1,mode:"register"};case"LOGIN_SUCCESS":return window.location.reload(),{...e,isLoading:!1,isError:!1};case"LOGIN_ERROR":return{...e,isLoading:!1,isError:!0,error:r.error?r.error:{message:"An error occurred."}};default:throw new Error}};function p({LoginButton:e}){const r=t.a.useRef(),[a,n]=t.a.useReducer(d,m),i=e=>{e.preventDefault(),n({type:"TOGGLE"})},s=()=>{n({type:"RESET"})};let p;a.isError?p=t.a.createElement("div",{className:"error"},a.error.hasOwnProperty("message")?a.error.message:"An error occurred"):"login"===a.mode?"username"===a.current?p="Erm... What's your name again?":"password"===a.current&&(p=`That's right! I remember now! Your name is ${a.user.username}!`):"register"===a.mode&&(p="We don't have anyone registered by that name. Would you like to register?");const E=()=>"username"===a.current?t.a.createElement(l,{name:"username",placeholder:"Username or Email",padding:19,autofocus:!0}):t.a.createElement(l,{type:"password",name:"password",placeholder:"Password",padding:19,autofocus:!0}),g=()=>"Register form here....";return t.a.createElement(t.a.Fragment,null,t.a.createElement(e,{handleClick:i}),t.a.createElement(o.a,{open:a.isOpen,close:i},t.a.createElement("form",{id:"loginform",ref:r,onSubmit:async e=>{e.preventDefault(),n({type:"INIT"});const t=r.current[a.current].value;if("username"===a.current){const e=await fetch("/api/login/"+t,{method:"GET",mode:"same-origin",credentials:"same-origin"});if(e.ok){const r=await e.json();n({type:"SUBMIT",inputName:"username",inputValue:r.collection.items[0].username,current:"password"})}else n({type:"REGISTER"})}else if("password"===a.current){const e={...a.user,password:t},r=await fetch("/api/login",{method:"POST",mode:"same-origin",credentials:"same-origin",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(r.ok)n({type:"LOGIN_SUCCESS"});else{const e=await r.json();console.log(r,e),n({type:"LOGIN_ERROR",error:e.collection.errors[0]})}}else n({type:"LOGIN_ERROR",error:"An unknown error occurred."})},className:a.isLoading?"loading":void 0},t.a.createElement("div",{id:"loginform-nav"},t.a.createElement(c.a,null,t.a.createElement(c.a.Item,{selected:!0},t.a.createElement("a",{href:"#login",onClick:s},"New Name")),t.a.createElement(c.a.Item,null,t.a.createElement("a",{href:"#blue",onClick:s},"Blue")),t.a.createElement(c.a.Item,null,t.a.createElement("a",{href:"#gary",onClick:s},"Gary")),t.a.createElement(c.a.Item,null,t.a.createElement("a",{href:"#john",onClick:s},"John")))),t.a.createElement("div",{id:"loginform-rival"}),t.a.createElement("div",{id:"loginform-message"},p),t.a.createElement("div",{id:"loginform-input"},"login"===a.mode?t.a.createElement(E,null):t.a.createElement(g,null)),t.a.createElement("div",{id:"loginform-submit"},a.isLoading?t.a.createElement(t.a.Fragment,null,t.a.createElement("span",null,"Oak is thinking")):t.a.createElement(t.a.Fragment,null,"login"===a.mode?t.a.createElement(u.a,{onClick:()=>n({type:"REGISTER"})},"Register"):t.a.createElement(u.a,{onClick:s},"Login"),t.a.createElement(u.a,{variant:"contained",type:"submit"},"Submit"))))))}}}]);
//# sourceMappingURL=Login_bundle.js.map