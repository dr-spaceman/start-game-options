(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{25:function(e,a,r){"use strict";r.r(a),r.d(a,"default",(function(){return d}));var n=r(0),t=r.n(n),l=r(9);r(5);function o(){return(o=Object.assign||function(e){for(var a=1;a<arguments.length;a++){var r=arguments[a];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function s({value:e="",type:a="text",padding:r=10,autofocus:n,placeholder:l,...s}){const[i,c]=t.a.useState(e),u=r-i.length,m="_".repeat(u>0?u:0),d="password"===a?"*".repeat(i.length):i;return n&&(s.ref=e=>e&&e.focus()),t.a.createElement("div",{className:"underlinedinput root"},t.a.createElement("input",o({type:a,value:i,onChange:e=>{c(e.target.value)},className:"underlinedinput-typography"},s)),t.a.createElement("div",{className:"underlinedinput-view"},i?t.a.createElement(t.a.Fragment,null,t.a.createElement("span",{className:"underlinedinput-value"},d),t.a.createElement("span",{className:"underlinedinput-carat"}," ")):t.a.createElement(t.a.Fragment,null,t.a.createElement("span",{className:"underlinedinput-carat"}," "),t.a.createElement("span",{className:"underlinedinput-placeholder"},l))),t.a.createElement("div",{className:"underlinedinput-underline"},t.a.createElement("span",{style:{opacity:0}},d),t.a.createElement("span",null,m)))}var i=r(3),c=r(4);console.log("<Login> has been lazy loaded!");const u={isOpen:!0,isLoading:!1,isError:!1,mode:"login",current:"username",user:{},error:{}},m=(e,a)=>{switch(a.type){case"RESET":return{...u};case"TOGGLE":return{...u,isOpen:!e.isOpen};case"SUBMIT":return{...e,isLoading:!0,isError:!1,user:{...e.user,[a.inputName]:a.inputValue}};case"NEXT":return{...e,isLoading:!1,isError:!1,current:a.current,user:{...e.user,[a.inputName]:a.inputValue}};case"REGISTER":return{...e,isLoading:!1,isError:!1,mode:"register"};case"LOGIN_SUCCESS":return window.location.reload(),{...e,isLoading:!1,isError:!1};case"ERROR":return{...e,isLoading:!1,isError:!0,error:a.error?a.error:{message:"An error occurred."}};default:throw new Error}};function d({LoginButton:e}){const a=t.a.useRef(),[r,n]=t.a.useReducer(m,u),o=e=>{e.preventDefault(),n({type:"TOGGLE"})},d=()=>{n({type:"RESET"})};let p;r.isError?p=t.a.createElement("div",{className:"error"},r.error.hasOwnProperty("message")?r.error.message:"An error occurred"):"login"===r.mode?"username"===r.current?p="Erm... What's your name again?":"password"===r.current&&(p=`That's right! I remember now! Your name is ${r.user.username}!`):r.mode;const E=()=>"username"===r.current?t.a.createElement(s,{name:"username",placeholder:"Username or Email",padding:19,autofocus:!0}):t.a.createElement(s,{type:"password",name:"password",placeholder:"Password",padding:19,autofocus:!0}),g=()=>t.a.createElement(t.a.Fragment,null,t.a.createElement(s,{name:"username",value:r.user.username,placeholder:"Username",padding:19,autofocus:!0}),t.a.createElement(s,{name:"email",value:r.user.email,placeholder:"Email",padding:19}),t.a.createElement(s,{type:"password",name:"password",placeholder:"Password",padding:19}));return t.a.createElement(t.a.Fragment,null,t.a.createElement(e,{handleClick:o}),t.a.createElement(l.a,{open:r.isOpen,close:o},t.a.createElement("form",{id:"loginform",ref:a,onSubmit:async e=>{e.preventDefault();const t=a.current[r.current].value;if(n({type:"SUBMIT",inputName:"username"===r.current&&t.includes("@")?"email":r.current,inputValue:t,current:"password"}),"username"===r.current){const e=await fetch("/api/login/"+t,{method:"GET",mode:"same-origin",credentials:"same-origin"});if(e.ok){const a=await e.json();n({type:"NEXT",inputName:"username",inputValue:a.collection.items[0].username,current:"password"})}else n({type:"REGISTER"}),n({type:"ERROR",error:{message:"We don't have anyone registered by that name. Would you like to register?"}})}else if("password"===r.current){const e={...r.user,password:t},a=await fetch("/api/login",{method:"POST",mode:"same-origin",credentials:"same-origin",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(a.ok)n({type:"LOGIN_SUCCESS"});else{const e=await a.json();console.log(a,e),n({type:"ERROR",error:e.collection.errors[0]})}}else n({type:"ERROR",error:"An unknown error occurred."})},className:r.isLoading?"loading":void 0},t.a.createElement("div",{id:"loginform-nav"},t.a.createElement(i.a,null,t.a.createElement(i.a.Item,{selected:!0},t.a.createElement("a",{href:"#login",onClick:d},"New Name")),t.a.createElement(i.a.Item,null,t.a.createElement("a",{href:"#blue",onClick:d},"Blue")),t.a.createElement(i.a.Item,null,t.a.createElement("a",{href:"#gary",onClick:d},"Gary")),t.a.createElement(i.a.Item,null,t.a.createElement("a",{href:"#john",onClick:d},"John")))),t.a.createElement("div",{id:"loginform-rival"}),t.a.createElement("div",{id:"loginform-message"},p),t.a.createElement("div",{id:"loginform-input"},"login"===r.mode?t.a.createElement(E,null):t.a.createElement(g,null)),t.a.createElement("div",{id:"loginform-submit"},r.isLoading?t.a.createElement(t.a.Fragment,null,t.a.createElement("span",null,"Oak is thinking")):t.a.createElement(t.a.Fragment,null,"login"===r.mode?t.a.createElement(c.a,{onClick:()=>n({type:"REGISTER"})},"Register"):t.a.createElement(c.a,{onClick:d},"Login"),t.a.createElement(c.a,{variant:"contained",type:"submit"},"Submit"))))))}}}]);
//# sourceMappingURL=login.bundle.js.map