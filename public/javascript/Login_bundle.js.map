{"version":3,"sources":["webpack:///./browser/src/components/UnderlinedInput.jsx","webpack:///./browser/src/components/Login.jsx"],"names":["typography","fontFamily","UnderlinedInput","value","type","padding","autofocus","props","state","setState","React","useState","placeholderPad","length","placeholder","repeat","ref","input","focus","className","style","position","left","top","zIndex","opacity","onChange","event","target","console","log","initialState","isOpen","isLoading","isError","mode","current","user","error","reducer","action","inputName","inputValue","window","location","reload","message","Error","Login","form","useRef","dispatchState","useReducer","toggleOpen","preventDefault","LoginButton","href","title","onClick","hasOwnProperty","username","LoginForm","name","RegisterForm","Modal","open","close","id","onSubmit","async","response","fetch","method","credentials","ok","result","json","collection","items","payload","password","headers","body","JSON","stringify","errors","undefined","NavMenu","Item","selected","disabled"],"mappings":"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","file":"Login_bundle.js","sourcesContent":["import React from 'react';\n\nconst typography = {\n    fontFamily: 'Press Start',\n};\n\nexport default function UnderlinedInput({ value = '', type = 'text', padding = 10, autofocus, ...props }) {\n    const [state, setState] = React.useState(value);\n    const handleChange = (event) => {\n        setState(event.target.value);\n    };\n    const placeholderPad = padding - state.length;\n    const placeholder = '_'.repeat(placeholderPad > 0 ? placeholderPad : 0);\n\n    if (autofocus) {\n        props.ref = (input) => input && input.focus();\n    }\n\n    return (\n        <div className=\"underlinedinput\" style={{ position: 'relative' }}>\n            <div className=\"underline\" style={{ position: 'absolute', left: 0, top: '.3em', zIndex: 0, ...typography }}>\n                <span style={{ opacity: 0 }}>{state}</span>\n                <span>{placeholder}</span>\n            </div>\n            <input type={type} value={state} onChange={handleChange} style={{ position: 'relative', zIndex: 1, ...typography }} {...props} />\n        </div>\n    );\n}\n","/* eslint-disable no-prototype-builtins */\n\n/**\n * Login component with login form\n * Note: Component is lazy loaded upon clicking login button\n */\n\nimport React from 'react';\nimport Modal from './Modal.jsx';\nimport UnderlinedInput from './UnderlinedInput.jsx';\nimport NavMenu from './NavMenu.jsx';\nimport { QuestionBlock, LoadingMascot } from '../lib/icons.js';\n\nconsole.log('<Login> has been lazy loaded!');\n\nconst API_ENDPOINT = `${process.env.API_ENDPOINT}/login`;\n\nconst initialState = {\n    isOpen: true,\n    isLoading: false,\n    isError: false,\n    mode: 'login', // login; register\n    current: 'username', // Form field to fill... username, password, email\n    user: {}, // user credentials: username, email, password\n    error: {},\n};\nconst reducer = (state, action) => {\n    switch (action.type) {\n        case 'TOGGLE':\n            return {\n                ...initialState,\n                isOpen: !state.isOpen,\n            };\n        case 'INIT':\n            return {\n                ...state,\n                isLoading: true,\n                isError: false,\n            };\n        case 'SUBMIT':\n            return {\n                ...state,\n                isLoading: false,\n                isError: false,\n                current: action.current,\n                user: {\n                    ...state.user,\n                    [action.inputName]: action.inputValue,\n                },\n            };\n        case 'REGISTER':\n            return {\n                ...state,\n                isLoading: false,\n                isError: false,\n                mode: 'register',\n            };\n        case 'LOGIN_SUCCESS':\n            window.location.reload();\n            return {\n                ...state,\n                isLoading: false,\n                isError: false,\n            };\n        case 'LOGIN_ERROR':\n            return {\n                ...state,\n                isLoading: false,\n                isError: true,\n                error: action.error ? action.error : { message: 'An error occurred.' },\n            };\n        default:\n            throw new Error();\n    }\n};\n\nexport default function Login() {\n    const form = React.useRef();\n\n    const [state, dispatchState] = React.useReducer(reducer, initialState);\n\n    const toggleOpen = (event) => {\n        event.preventDefault();\n        dispatchState({ type: 'TOGGLE' });\n    };\n\n    const handleSubmit = async (event) => {\n        event.preventDefault();\n\n        dispatchState({ type: 'INIT' });\n\n        const input = form['current'][state.current]['value'];\n\n        if (state.current === 'username') {\n            const response = await fetch(`${API_ENDPOINT}/${input}`, {\n                method: 'GET',\n                mode: 'same-origin',\n                credentials: 'same-origin',\n            });\n            if (response.ok) {\n                const result = await response.json();\n                dispatchState({\n                    type: 'SUBMIT',\n                    inputName: 'username',\n                    inputValue: result.collection.items[0].username,\n                    current: 'password',\n                });\n            } else {\n                dispatchState({ type: 'REGISTER' });\n            }\n        } else if (state.current === 'password') {\n            const payload = {\n                ...state.user,\n                password: input,\n            };\n\n            const response = await fetch(API_ENDPOINT, {\n                method: 'POST',\n                mode: 'same-origin',\n                credentials: 'same-origin',\n                headers: {\n                    'Content-Type': 'application/json',\n                },\n                body: JSON.stringify(payload),\n            });\n            if (response.ok) {\n                dispatchState({ type: 'LOGIN_SUCCESS' });\n            } else {\n                const result = await response.json();\n                console.log(response, result);\n                dispatchState({ type: 'LOGIN_ERROR', error: result.collection.errors[0] });\n            }\n        } else {\n            dispatchState({ type: 'LOGIN_ERROR', error: 'An unknown error occurred.' });\n        }\n    };\n\n    const LoginButton = () => (\n        <a href=\"/login.php\" title=\"Login\" onClick={toggleOpen} className=\"user user-unknown\">\n            <QuestionBlock className=\"user-avatar thumbnail\" />\n            <span className=\"user-username\">Login</span>\n        </a>\n    );\n\n    let message;\n    if (state.isError) {\n        message = <div className=\"error\">{state.error.hasOwnProperty('message') ? state.error.message : 'An error occurred'}</div>;\n    } else if (state.mode === 'login') {\n        if (state.current === 'username') message = \"Erm... What's your name again?\";\n        else if (state.current === 'password') message = `That's right! I remember now! Your name is ${state.user.username}!`;\n    } else if (state.mode === 'register') {\n        message = 'We don\\'t have anyone registered by that name. Would you like to register?';\n    }\n\n    const LoginForm = () => {\n        if (state.current === 'username') {\n            return <UnderlinedInput name=\"username\" placeholder=\"Username or Email\" padding={19} autofocus />;\n        }\n\n        return <UnderlinedInput type=\"password\" name=\"password\" placeholder=\"Password\" padding={19} autofocus />;\n    };\n\n    const RegisterForm = () => 'Register form here....';\n\n    return (\n        <>\n            <LoginButton />\n            <Modal open={state.isOpen} close={toggleOpen}>\n                <form id=\"loginform\" ref={form} onSubmit={handleSubmit} className={state.isLoading ? 'loading' : undefined}>\n                    <div id=\"loginform-nav\">\n                        <NavMenu>\n                            <NavMenu.Item selected><a href=\"#login\">New Name</a></NavMenu.Item>\n                            <NavMenu.Item><a href=\"#blue\">Blue</a></NavMenu.Item>\n                            <NavMenu.Item><a href=\"#gary\">Gary</a></NavMenu.Item>\n                            <NavMenu.Item><a href=\"#john\">John</a></NavMenu.Item>\n                        </NavMenu>\n                    </div>\n                    <div id=\"loginform-rival\" />\n                    <div id=\"loginform-message\">\n                        {message}\n                    </div>\n                    <div id=\"loginform-input\">\n                        {state.mode === 'login' ? <LoginForm /> : <RegisterForm />}\n                    </div>\n                    <div id=\"loginform-submit\">\n                        {state.isLoading ? (\n                            <>\n                                <LoadingMascot className=\"loading\" />\n                                <span>Professor Oak is thinking</span>\n                            </>\n                        ) : (\n                            <button type=\"submit\" disabled={state.isLoading}>Submit</button>\n                        )}\n                    </div>\n                </form>\n            </Modal>\n        </>\n    );\n}\n"],"sourceRoot":""}