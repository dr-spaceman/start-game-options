(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{43:function(e,r,a){"use strict";a.r(r),a.d(r,"default",(function(){return p}));var n=a(0),t=a.n(n),o=a(12);function s(){return(s=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var a=arguments[r];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}const i={fontFamily:"Press Start"};function l({value:e="",type:r="text",padding:a=10,autofocus:n,...o}){const[l,c]=t.a.useState(e),u=a-l.length,m="_".repeat(u>0?u:0);return n&&(o.ref=e=>e&&e.focus()),t.a.createElement("div",{className:"underlinedinput",style:{position:"relative"}},t.a.createElement("div",{className:"underline",style:{position:"absolute",left:0,top:".3em",zIndex:0,...i}},t.a.createElement("span",{style:{opacity:0}},l),t.a.createElement("span",null,m)),t.a.createElement("input",s({type:r,value:l,onChange:e=>{c(e.target.value)},style:{position:"relative",zIndex:1,...i}},o)))}var c=a(4),u=a(8);console.log("<Login> has been lazy loaded!");const m={isOpen:!0,isLoading:!1,isError:!1,mode:"login",current:"username",user:{},error:{}},d=(e,r)=>{switch(r.type){case"TOGGLE":return{...m,isOpen:!e.isOpen};case"INIT":return{...e,isLoading:!0,isError:!1};case"SUBMIT":return{...e,isLoading:!1,isError:!1,current:r.current,user:{...e.user,[r.inputName]:r.inputValue}};case"REGISTER":return{...e,isLoading:!1,isError:!1,mode:"register"};case"LOGIN_SUCCESS":return window.location.reload(),{...e,isLoading:!1,isError:!1};case"LOGIN_ERROR":return{...e,isLoading:!1,isError:!0,error:r.error?r.error:{message:"An error occurred."}};default:throw new Error}};function p(){const e=t.a.useRef(),[r,a]=t.a.useReducer(d,m),n=e=>{e.preventDefault(),a({type:"TOGGLE"})},s=()=>t.a.createElement("a",{href:"/login.php",title:"Login",onClick:n,className:"user user-unknown"},t.a.createElement(u.b,{className:"user-avatar thumbnail"}),t.a.createElement("span",{className:"user-username"},"Login"));let i;r.isError?i=t.a.createElement("div",{className:"error"},r.error.hasOwnProperty("message")?r.error.message:"An error occurred"):"login"===r.mode?"username"===r.current?i="Erm... What's your name again?":"password"===r.current&&(i=`That's right! I remember now! Your name is ${r.user.username}!`):"register"===r.mode&&(i="We don't have anyone registered by that name. Would you like to register?");const p=()=>"username"===r.current?t.a.createElement(l,{name:"username",placeholder:"Username or Email",padding:19,autofocus:!0}):t.a.createElement(l,{type:"password",name:"password",placeholder:"Password",padding:19,autofocus:!0}),g=()=>"Register form here....";return t.a.createElement(t.a.Fragment,null,t.a.createElement(s,null),t.a.createElement(o.a,{open:r.isOpen,close:n},t.a.createElement("form",{id:"loginform",ref:e,onSubmit:async n=>{n.preventDefault(),a({type:"INIT"});const t=e.current[r.current].value;if("username"===r.current){const e=await fetch("/api/login/"+t,{method:"GET",mode:"same-origin",credentials:"same-origin"});if(e.ok){const r=await e.json();a({type:"SUBMIT",inputName:"username",inputValue:r.collection.items[0].username,current:"password"})}else a({type:"REGISTER"})}else if("password"===r.current){const e={...r.user,password:t},n=await fetch("/api/login",{method:"POST",mode:"same-origin",credentials:"same-origin",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(n.ok)a({type:"LOGIN_SUCCESS"});else{const e=await n.json();console.log(n,e),a({type:"LOGIN_ERROR",error:e.collection.errors[0]})}}else a({type:"LOGIN_ERROR",error:"An unknown error occurred."})},className:r.isLoading?"loading":void 0},t.a.createElement("div",{id:"loginform-nav"},t.a.createElement(c.a,null,t.a.createElement(c.a.Item,{selected:!0},t.a.createElement("a",{href:"#login"},"New Name")),t.a.createElement(c.a.Item,null,t.a.createElement("a",{href:"#blue"},"Blue")),t.a.createElement(c.a.Item,null,t.a.createElement("a",{href:"#gary"},"Gary")),t.a.createElement(c.a.Item,null,t.a.createElement("a",{href:"#john"},"John")))),t.a.createElement("div",{id:"loginform-rival"}),t.a.createElement("div",{id:"loginform-message"},i),t.a.createElement("div",{id:"loginform-input"},"login"===r.mode?t.a.createElement(p,null):t.a.createElement(g,null)),t.a.createElement("div",{id:"loginform-submit"},r.isLoading?t.a.createElement(t.a.Fragment,null,t.a.createElement(u.a,{className:"loading"}),t.a.createElement("span",null,"Professor Oak is thinking")):t.a.createElement("button",{type:"submit",disabled:r.isLoading},"Submit")))))}}}]);
//# sourceMappingURL=Login_bundle.js.map